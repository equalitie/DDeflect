---

- name: Install basic package requirements
  apt: pkg={{item}} state=installed
  with_items:
    - sudo
    - rsync
    - ntp
    - iftop
    - vim
    - screen

- name: Ensure ntpd is running and enabled
  service: name=ntp state=running enabled=yes

- name: Set up sudoers
  copy: src=sudoers dest=/etc/sudoers

- name: Create traffiserver group
  group: name=trafserv state=present gid=99

- name: Create trafficserver user
  user: name=trafserv state=present groups=trafserv uid=99

- name: Ensure the Deflect apt repository is added
  apt_repository: state=present repo='deb http://brains.deflect.ca/repo/ wheezy main'

- name: set locale to {{ locale }}
  command: /usr/sbin/update-locale LANG={{ locale }} LC_ALL={{ locale }}

- name: set /etc/localtime to {{ timezone }}
  command: /bin/cp /usr/share/zoneinfo/{{ timezone }} /etc/localtime

- name: set /etc/timezone to {{ timezone }}
  template: src=timezone dest=/etc/timezone
  notify: update tzdata
